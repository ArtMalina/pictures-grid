(this["webpackJsonppictures-grid"]=this["webpackJsonppictures-grid"]||[]).push([[0],{47:function(e,t,n){},48:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var r,c,l,i=n(3),o=n.n(i),u=n(39),a=n.n(u),s=(n(47),n(5)),b=(n(48),n(10)),f=n(41),d=n(4);!function(e){e[e.None=-1]="None",e[e.Move=0]="Move",e[e.Click=1]="Click"}(r||(r={})),function(e){e.None="<none>",e.Buy="<buy-cell>",e.Edit="<edit-cell>"}(c||(c={})),function(e){e.None="None",e.Open="Open",e.Close="Close",e.Save="Save",e.Buy="Buy",e.RemoveItems="RemoveItems",e.Modify="Modify",e.ShowOwn="ShowOwn",e.ShowOther="ShowOther",e.SaveTiles="SaveTiles"}(l||(l={}));var p=n(1),m=function(e){var t=e.title,n=e.event$,r=e.toggle,c=e.noActive,o=e.light,u=e.small,a=e.color,b=e.action,f=e.group,m=e.noBraces,j=e.fullWidth,h=e.textAlign,v=Object(i.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),n&&n.next(b?Object(d.a)(Object(d.a)({},b),{},{group:f}):{type:l.Close,payload:[]})}),[n,b,f]),O=[j&&"full-width",h&&"align-".concat(h),c&&"no-action",o&&"light",u&&"small",a].filter(Boolean).map((function(e){return"btn--".concat(e)}));return 1===r&&O.push("btn--untoggled"),2===r&&O.push("btn--toggled"),f&&O.push("btn--grouped"),Object(p.jsxs)("div",{className:["btn"].concat(Object(s.a)(O)).join(" "),onClick:v,children:[!m&&Object(p.jsx)("div",{className:"btn_border btn_border--left"}),!!t&&Object(p.jsx)("div",{className:"btn-text",children:t||""}),e.children,!m&&Object(p.jsx)("div",{className:"btn_border btn_border--right"})]})},j=function(e){var t=e.event$,n=e.selectedCells$,r=Object(i.useMemo)((function(){return new f.a}),[]),c=Object(i.useState)([1,2]),o=Object(b.a)(c,2),u=o[0],a=o[1],d=Object(i.useRef)(u),j=Object(i.useState)([]),h=Object(b.a)(j,2),v=h[0],O=h[1];return Object(i.useEffect)((function(){var e=r.subscribe((function(e){if(console.log("%c filterBtn ev: ","background-color: brown; color: white;",e),console.log("downEv togglesStateRef.current",d.current),e.type===l.ShowOwn){if(e.group){var n=Object(b.a)(d.current,2),r=n[0],c=n[1];d.current=[1===r?2:1,1===c?2:1],a(d.current)}return t.next({type:1===d.current[0]?l.ShowOther:l.ShowOwn,payload:e.payload})}t.next(e)}));return function(){return e.unsubscribe()}}),[r,t,d]),Object(i.useEffect)((function(){var e=n.subscribe((function(e){console.log("%c filterBtn ev: ","background-color: brown; color: white;",e),O(Object(s.a)(e))}));return function(){return e.unsubscribe()}}),[n]),Object(p.jsx)("header",{children:Object(p.jsxs)("div",{className:"header_content",children:[Object(p.jsx)("div",{className:"flex-cnt align-center mx-4",children:Object(p.jsx)(m,{light:!0,color:"header",title:"Hello, crypto man"})}),Object(p.jsx)("div",{style:{backgroundColor:"white",padding:"0 10px"}}),Object(p.jsxs)("div",{className:"flex-cnt align-center",children:[Object(p.jsx)("div",{className:"flex-cnt item fb-3",children:Object(p.jsxs)(m,{light:!0,small:!0,color:"primary",title:"TILES",event$:r,action:{type:l.ShowOwn,payload:[]},group:1,children:[Object(p.jsx)(m,{event$:r,action:{type:l.ShowOwn,payload:[]},light:!0,small:!0,noBraces:!0,group:1,toggle:u[0],color:"primary",title:"MY"}),Object(p.jsx)(m,{event$:r,action:{type:l.ShowOwn,payload:[]},light:!0,small:!0,noBraces:!0,group:2,toggle:u[1],color:"primary",title:"FOR SALE"})]})}),Object(p.jsxs)("div",{className:"flex-cnt justify-end",style:{width:250},children:[Object(p.jsx)("div",{className:"flex-cnt item shrink mx-3",children:Object(p.jsx)(m,{event$:t,action:{type:1===u[0]?l.Open:l.Modify,payload:[]},light:!0,color:"info",title:1===u[0]?"Details":"Modify"})}),Object(p.jsx)("div",{className:"flex-cnt item shrink badge-cnt",children:!!v.length&&Object(p.jsx)("div",{className:"badge badge--primary",children:1===u[0]?"!":v.length})})]})]})]})})},h=n(6),v=n(18),O=n(17),y=o.a.createContext(null),g=function(e){var t=e.width,n=e.height,c=e.event$,l=e.canvas2dCtxInList$,o=Object(i.useCallback)((function(e){c.next([r.Click,e])}),[c]),u=Object(i.useCallback)((function(e){c.next([r.Move,e])}),[c]),a=Object(i.useCallback)((function(e){if(e&&!l.getValue().length){var t=e.getContext("2d");t&&l.next([t])}}),[l]);return Object(p.jsx)("div",{id:"canvas-container",style:{width:t,height:n},children:Object(p.jsx)("canvas",{id:"canvas",onClick:o,onMouseMove:u,onMouseLeave:u,width:t,height:n,ref:a})})},x={inRowCells:0,cellsAmount:500,cellWidth:50,cellHeight:50,cellBorderWidth:2,maxCanvasWidth:1350};function N(e){var t=Math.floor(e/x.inRowCells);return[e-x.inRowCells*t,t]}x.inRowCells=Math.floor((x.maxCanvasWidth-x.cellBorderWidth)/(x.cellWidth+x.cellBorderWidth));var C,w=function(e,t){return t.reduce((function(t,n){return!t[0]&&!t[1]||t[e]>n[e]?[n[0],n[1]]:t}),[0,0])},k=function(e,t){return t.reduce((function(t,n){return!t[0]&&!t[1]||t[e]<n[e]?[n[0],n[1]]:t}),[0,0])},T=["#212529","#23272c","#22262b","#23282e","#25292e"];!function(e){e.BASE="#000000",e.HOVERED="yellow",e.SELECTED="orange",e.HOVER_SELECTED="#69f0ae",e.SHOW_FILTERED_TILES="silver"}(C||(C={}));var S,E=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return function(i){return[i[0]*e+n,i[1]*t+r,i[2]*e-c,i[3]*t-l]}},M=function(e,t,n,r,c,l){var i=Object(b.a)(t,1)[0],o=.5*l,u=.5*l;Array.from(new Array(n)).forEach((function(t,n){var a=l;u+r>i&&(u=.5*l,o+=c+l),function(t,n,i){(function(e,t,n,r){var c=Object(b.a)(t,4),l=c[0],i=c[1],o=c[2],u=c[3];e.beginPath(),e.fillStyle=T[Math.floor(5*Math.random())],e.rect(l,i,o+n,u+n),e.fill(),e.lineWidth=n,e.strokeStyle=C.BASE,e.stroke(),e.font="italic 12pt Arial",e.fillStyle="#4fc3f7",e.fillText("".concat(r.cellNumber.toString()),Math.round(l+.1*o),Math.round(i+.5*u-5))})(e,[n,i,r,c],l,{cellNumber:t+1,point:[-1,-1]})}(n,u,o),u+=r+a}))},A=function(e,t,n,r,c,l){var i=Object(b.a)(t.point,2),o=i[0],u=i[1],a=Object(b.a)(r,2),s=a[0],f=a[1],d=.5*c+(s+c)*o,p=.5*c+(f+c)*u;e.beginPath(),e.rect(d,p,s+c,f+c),e.lineWidth=c,e.strokeStyle=l,e.stroke()},_=function(e,t,n,r,c){var l,i=Object(b.a)(r,2),o=i[0],u=i[1],a={left:w(0,l=n),top:w(1,l),right:k(0,l),bottom:k(1,l)},s=a.left,f=a.right,d=a.bottom,p=a.top;console.warn("corners: left",s),console.warn("corners: right",f),console.warn("corners: top",p),console.warn("corners: bottom",d);var m=f[0]-s[0]+1,j=d[1]-p[1]+1;console.log("dx dy in bounded ",m,j,c);var h=E(t.width/m,t.height/j,-s[0]*t.width/m,-p[1]*t.height/j,1/m,1/j),v=E(o,u,1,1,0,0);n.forEach((function(n){console.log("t",n);var r=h([n[0],n[1],1,1]),l=Object(b.a)(r,4),i=l[0],o=l[1],u=l[2],a=l[3],s=v([n[0],n[1],1,1]),f=Object(b.a)(s,4),d=f[0],p=f[1],m=f[2],j=f[3];console.log("%c crop x-y-w-h ","background-color: brown;color: white",i,o,u,a),console.log("%c real x-y-w-h ","background-color: brown;color: white",d,p,m,j);var O=.5*c+c*n[0],y=.5*c+c*n[1];e.drawImage(t,i,o,u,a,d+O,p+y,m,j)}))},B=function(e){var t=e.cellW,n=e.cellH,c=e.cellBorderWidth,l=e.amount,o=e.canvas2dCtxInList$,u=e.event$,a=e.canvasSize;return Object(i.useEffect)((function(){console.log("%c render cells Grid! ","border: 1px solid orange;",a);var e=o.subscribe((function(e){e.forEach((function(e){M(e,a,l,t,n,c)}))}));return function(){return e.unsubscribe()}}),[t,n,c,l,a,o]),Object(i.useEffect)((function(){var e=u.subscribe((function(e){var l=e.displayCells,i=e.clearCells,u=e.displayTiles,a=(e.clearTiles,e.highlightCells);o.getValue().forEach((function(e){var o={},s={},f=[];u.forEach((function(r){console.log("%c tileCell ","background-color: grey; color: blue;",r),function(e,t,n,r,c){var l=Object(b.a)(r,2),i=l[0],o=l[1],u=Object(b.a)(t.point,2),a=u[0],s=u[1],f=c+(i+c)*a,d=c+(o+c)*s;if(e.beginPath(),e.fillStyle="#37474f",e.rect(f,d,i,o),e.fill(),t.tile.url){var p=new Image;p.onload=function(){if(t.tile.boundedTiles.length&&t.tile.boundedTiles[0]===t.tile.id)return console.warn("draw image",p,t.tile),void _(e,p,t.tile.boundedTiles.map((function(e){return N(e)})),[i,o],c);console.log("draw tile cell",t),e.beginPath(),e.rect(f,d,i,o),e.fillStyle="#37474f",e.fill(),e.drawImage(p,f,d,i,o)},p.src=t.tile.url}}(e,r,0,[t,n],c)})),i.forEach((function(i){var u=i.cellNumber,a=i.point,s=l.filter((function(e){return e.mouseType===r.Click&&e.cellNumber===u}));o[u]=1,s.length||A(e,{cellNumber:u,point:a},0,[t,n],c,C.BASE)})),a.forEach((function(r){var l=r.cellNumber,i=r.point;A(e,{cellNumber:l,point:i},0,[t,n],c,C.SHOW_FILTERED_TILES)})),l.forEach((function(l){var i=l.cellNumber,o=l.mouseType,u=l.point,a=o===r.Click?C.SELECTED:C.HOVERED;s[i]?f.push(l):A(e,{cellNumber:i,point:u},0,[t,n],c,a),o===r.Click&&(s[i]=2),o===r.Move&&(s[i]=1)})),f.forEach((function(r){var l=r.cellNumber,i=r.point;A(e,{cellNumber:l,point:i},0,[t,n],c,C.HOVER_SELECTED)}))}))}));return function(){return e.unsubscribe()}}),[u,o,t,n,c,a]),null};!function(e){e[e.None=0]="None",e[e.Add=1]="Add",e[e.Remove=2]="Remove",e[e.UpdateByContract=3]="UpdateByContract",e[e.DisplayOwnCells=4]="DisplayOwnCells",e[e.DisplayOtherCells=5]="DisplayOtherCells",e[e.DisplayAll=6]="DisplayAll",e[e.UserUpdateTileGroup=7]="UserUpdateTileGroup"}(S||(S={}));var I,$=function(e,t,n){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:e.mouseType}},R=function(e){var t=e.cellSize,n=e.cellsAmount,l=e.cellBorderWidth,o=e.maxCanvasWidth,u=e.event$,a=e.cellsUpdate$,f=e.currentAcc$,m=Object(i.useRef)(c.Buy),j=Object(i.useContext)(y),x=Object(b.a)(t,2),N=x[0],C=x[1],w=Object(i.useState)([0,0,!1]),k=Object(b.a)(w,2),T=k[0],E=k[1],M=Object(i.useRef)(null),A=Object(i.useRef)([0,0]),_=Object(i.useRef)([0,0]),I=Object(i.useRef)([]),R=Object(i.useRef)({}),D=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),U=Object(i.useMemo)((function(){return new O.Subject}),[]),W=Object(i.useMemo)((function(){return new v.BehaviorSubject({displayCells:[],clearCells:[],displayTiles:[],clearTiles:[],highlightCells:[],shadeCells:[]})}),[]),L=Object(i.useMemo)((function(){return new v.BehaviorSubject({})}),[]),V=Object(i.useState)([!1,null]),H=Object(b.a)(V,2),P=(H[0],H[1],Object(i.useCallback)((function(e){if(e){var t=N,r=o,c=Math.floor((r-l)/(t+l)),i=(c+1)*l+c*t,u=Math.ceil(n/c),a=u*C+u*l+l;M.current=e,_.current=[c,u],A.current=[i,a],E([i,a,!0])}}),[M,A,_,n,l,o,N,C]));return Object(i.useEffect)((function(){var e=j.getState().subscribe((function(e){console.log("new state",Object(d.a)({},e));var t=u.getValue(),n=R.current,l=t.reduce((function(e,t,n){return Object(d.a)(Object(d.a)({},e),{},Object(h.a)({},t.curr.cellNumber,n))}),{}),i={},o=!1;e.tileCells.forEach((function(t){console.log("tile",t,l),i[t.cellNumber]=[e.lastUpdate,Object(d.a)({},t)],(!n[t.cellNumber]||n[t.cellNumber]<e.lastUpdate)&&(n[t.cellNumber]=e.lastUpdate,l[t.cellNumber]>0&&(o=!0))})),o&&a.next([S.UpdateByContract,Object(s.a)(t)]),L.next(Object(d.a)({},i));var b=[];m.current===c.Edit&&(b=e.tileCells.filter((function(e){return e.tile&&e.tile.owner===j.getAccount()})).map((function(e){return{cellNumber:e.cellNumber,mouseType:r.None,point:e.point}})),I.current=Object(s.a)(b)),W.next({displayCells:[],clearCells:[],displayTiles:Object(s.a)(e.tileCells),clearTiles:[],highlightCells:Object(s.a)(b),shadeCells:[]})}));return function(){return e.unsubscribe()}}),[j,W,u,I,a,L,R,m]),Object(i.useEffect)((function(){var e=a.subscribe((function(e){var t=e[0],n=e[1];console.log("cellsUpdate$",t,n);var l=u.getValue();if(t===S.DisplayAll||t===S.DisplayOwnCells){var i=t===S.DisplayAll?Object(s.a)(I.current):[];m.current=t===S.DisplayAll?c.Buy:c.Edit,I.current=e[1].map((function(e){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:r.None}}));var o=l.filter((function(e){return e.mouseType===r.Click&&i.findIndex((function(t){return t.cellNumber===e.curr.cellNumber}))<0})).map((function(e){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:e.mouseType}}));return u.next(l.filter((function(e){return e.mouseType!==r.Click}))),W.next({displayCells:[],clearCells:[].concat(Object(s.a)(i),Object(s.a)(o)),displayTiles:[],clearTiles:[],highlightCells:Object(s.a)(I.current),shadeCells:[]})}if(t!==S.UpdateByContract&&t===S.Remove){var a=l.filter((function(t){return t.mouseType!==r.Click||e[1].findIndex((function(e){return e.cellNumber===t.curr.cellNumber}))<0}));return u.next(Object(s.a)(a)),void W.next({displayCells:a.filter((function(e){return e.mouseType===r.Click})).map($),clearCells:e[1].map((function(e){return{cellNumber:e.cellNumber,point:e.point,mouseType:r.Click}})),displayTiles:[],clearTiles:[],highlightCells:[],shadeCells:[]})}}));return function(){return e.unsubscribe()}}),[a,u,W,m,I]),Object(i.useEffect)((function(){var e=U.subscribe((function(e){var t=Object(b.a)(e,2),n=t[0],i=t[1],o=i.clientX,a=i.clientY,p=i.currentTarget,j=p.offsetLeft,h=p.offsetTop,v=M.current?[M.current.scrollLeft,M.current.scrollTop]:[0,0],O=Object(b.a)(v,2),y=O[0],g=O[1],x=u.getValue();if(o-j+y+l>=A.current[0]||o<=j||a<=h||a-h+g+l>=A.current[1]){var w=x.filter((function(e){return e.mouseType!==r.Move}));return W.next({displayCells:w.map($),clearCells:x.filter((function(e){return e.mouseType===r.Move&&I.current.findIndex((function(t){return t.cellNumber===e.curr.cellNumber}))<0})).map($),displayTiles:[],clearTiles:[],highlightCells:Object(s.a)(I.current),shadeCells:[]}),void u.next(Object(s.a)(w))}var k=function(e,t,n){var r=n.inRowCount,c=n.cellW,l=n.cellH,i=Math.floor(e/c),o=Math.floor(t/l);return{cellNumber:o*r+i,x:i,y:o,w:c,h:l}}(o+y-j,a+g-h,{inRowCount:_.current[0],cellW:N+l,cellH:C+l}),T={cellNumber:k.cellNumber,point:[k.x,k.y]};if(n!==r.Move||!x.find((function(e){return e.mouseType===n&&e.curr.cellNumber===k.cellNumber}))){var S=m.current,E=f.getValue(),B=L.getValue(),R=n===r.Click,D=x.length&&n===r.Move,U=S===c.Edit&&R&&(!B[T.cellNumber]||B[T.cellNumber][1].tile.owner!==E);U&&(R=!1);var V={display:x.length||U?[]:[Object(d.a)(Object(d.a)({},T),{},{mouseType:n})],clear:[],finalCellEvents:x.length||U?[]:[{mouseType:n,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(d.a)({},T)}]};if(x.forEach((function(e){if(n===r.Click){if(S===c.Edit&&e.mouseType===r.Click&&(!B[e.curr.cellNumber]||B[e.curr.cellNumber][1].tile.owner!==E))return void(R=!1);if(S!==c.Edit||e.mouseType!==r.Click||U||e.curr.cellNumber!==T.cellNumber&&V.display.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:e.mouseType})),S===c.Buy&&e.mouseType===r.Click&&B[e.curr.cellNumber]&&B[e.curr.cellNumber][1].tile.owner===E)return;if(S===c.Buy&&e.curr.cellNumber!==T.cellNumber)return void V.clear.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:n}));if(e.curr.cellNumber===T.cellNumber&&e.mouseType===n)return R=!1,void V.clear.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:n}));e.curr.cellNumber===T.cellNumber&&e.mouseType!==n&&V.display.push(Object(d.a)(Object(d.a)({},T),{},{mouseType:r.Move})),V.finalCellEvents.push(Object(d.a)({},e))}if(n===r.Move){if(e.mouseType===n&&e.curr.cellNumber===T.cellNumber)return D=!1,void V.finalCellEvents.push(Object(d.a)({},e));if(e.curr.cellNumber===T.cellNumber&&e.mouseType===r.Click)return V.finalCellEvents.push(Object(d.a)({},e)),void V.display.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:e.mouseType}));if(e.mouseType===n&&e.curr.cellNumber!==T.cellNumber)return D=!1,V.clear.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:n})),V.finalCellEvents.push({mouseType:e.mouseType,lastCell:Object(d.a)({},e.curr),curr:Object(d.a)({},T)}),void V.display.push(Object(d.a)(Object(d.a)({},T),{},{mouseType:n}));V.finalCellEvents.push(Object(d.a)({},e)),V.display.push(Object(d.a)(Object(d.a)({},e.curr),{},{mouseType:e.mouseType}))}})),D&&(V.finalCellEvents.push({mouseType:n,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(d.a)({},T)}),V.display.push(Object(d.a)(Object(d.a)({},T),{},{mouseType:n}))),R){if(S===c.Buy&&B[T.cellNumber]&&B[T.cellNumber][1].tile.owner===E)return;V.finalCellEvents.push({mouseType:n,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(d.a)({},T)}),V.display.push(Object(d.a)(Object(d.a)({},T),{},{mouseType:n}))}n===r.Click&&(U&&(V.finalCellEvents=V.finalCellEvents.filter((function(e){return e.mouseType!==r.Click}))),console.log("final res",R,Object(d.a)({},V))),(V.display.length||V.clear.length)&&W.next({displayCells:Object(s.a)(V.display),clearCells:V.clear.filter((function(e){return I.current.findIndex((function(t){return t.cellNumber===e.cellNumber}))<0})),displayTiles:[],clearTiles:[],highlightCells:I.current.filter((function(e){return V.display.findIndex((function(t){return t.cellNumber===e.cellNumber}))<0})),shadeCells:[]}),n===r.Click&&console.log("\nresult",Object(d.a)({},V)),u.next(Object(s.a)(V.finalCellEvents))}}));return function(){return e.unsubscribe()}}),[M,A,_,u,m,L,f,W,U,I,l,N,C]),Object(p.jsxs)("div",{id:"cells-body",className:"overflow",ref:P,children:[Object(p.jsx)(g,{width:T[0],height:T[1],canvas2dCtxInList$:D,event$:U}),T[0]&&T[1]&&Object(p.jsx)(B,{event$:W,canvas2dCtxInList$:D,amount:n,cellW:t[0],cellH:t[1],cellBorderWidth:l,canvasSize:[T[0],T[1]]})]})},D=n(63),U=function(e){var t=e.value,n=e.event$,r=e.noActive,c=e.light,l=e.small,o=e.color,u=e.action,a=Object(i.useState)(t||""),f=Object(b.a)(a,2),d=f[0],m=f[1],j=Object(i.useCallback)((function(e){m(e.currentTarget.value),n&&n.next([e.currentTarget.value,u])}),[n,u]),h=[r&&"no-action",c&&"light",l&&"small",o].filter(Boolean).map((function(e){return"text-input--".concat(e)}));return Object(p.jsx)("div",{className:["text-input"].concat(Object(s.a)(h)).join(" "),children:Object(p.jsx)("input",{type:"text",value:d,onChange:j,disabled:r})})},W=function(e){var t=e.title,n=e.width,r=e.height,c=e.event$,o=e.open,u=Object(i.useState)({type:l.Close,payload:[],groupUrl:""}),a=Object(b.a)(u,2),s=a[0],f=a[1];if(Object(i.useEffect)((function(){console.log("useEffect in modal....");var e=c.subscribe((function(e){console.log("ev in modal: ",e),[l.Modify,l.Open].includes(e.type)&&f(e)}));return function(){return e.unsubscribe()}}),[c]),console.log("Modal state",s),!o)return null;var d=!!s.payload.filter((function(e){return!e.token&&!e.tile})).length,j=s&&s.type===l.Modify?"Save":"Buy";j=s&&s.type===l.Open?"Buy":j,j=d?"Mint":j;var h=s&&s.type===l.Open||d?l.Buy:l.Save;return Object(p.jsx)("div",{id:"modal-overlay-cnt",children:Object(p.jsxs)("div",{id:"modal-cnt",style:{width:n,height:r,top:"25%",marginLeft:-.5*n},children:[Object(p.jsxs)("div",{className:"header",children:[Object(p.jsx)(m,{light:!0,color:"header",noActive:!0,title:t}),Object(p.jsxs)("div",{className:"flex-cnt",children:[Object(p.jsx)(m,{event$:c,action:{type:h,payload:[]},light:!0,color:"active",title:j}),Object(p.jsx)("div",{className:"flex-cnt item mx-1"}),Object(p.jsx)(m,{event$:c,action:{type:l.Close,payload:[]},light:!0,color:"close",title:"Close"})]})]}),Object(p.jsx)("div",{className:"content",children:e.children}),Object(p.jsx)("div",{className:"footer"})]})})};!function(e){e[e.None=0]="None",e[e.BuyCellsMode=1]="BuyCellsMode",e[e.ModifyCellsMode=2]="ModifyCellsMode"}(I||(I={}));var L=function(e){var t=e.event$,n=Object(i.useMemo)((function(){return new O.Subject}),[]),r=Object(i.useMemo)((function(){return new O.Subject}),[]),c=Object(i.useMemo)((function(){return new O.Subject}),[]),o=Object(i.useState)([I.None,[]]),u=Object(b.a)(o,2),a=u[0],f=u[1],j=Object(i.useRef)([]),h=a[1].reduce((function(e,t){return t.tile?e&&t.tile.url?"":t.tile.url||e:e}),""),v=Object(i.useMemo)((function(){return new D.a([h||"",null])}),[h]);return Object(i.useEffect)((function(){var e=t.subscribe((function(e){console.log("%c event$ in cart-modal: ","border: 1px solid green",e,v.getValue()),e.type!==l.Modify&&e.type!==l.Open||(v.next(["",null]),j.current=Object(s.a)(e.payload),f([e.type===l.Modify?I.ModifyCellsMode:I.BuyCellsMode,Object(s.a)(e.payload)]),c.next(e))})),n=c.subscribe((function(e){console.log("cart event",e,Object(s.a)(j.current)),[l.Close,l.Save,l.Buy].includes(e.type)&&(e.type===l.Buy?j.current.length&&t.next({type:l.Buy,payload:j.current.map((function(e){return Object(d.a)({},e)})),groupUrl:v.getValue()[0]}):e.type===l.Save&&(j.current.length?t.next({type:l.SaveTiles,payload:Object(s.a)(j.current),groupUrl:v.getValue()[0]}):t.next(e)),j.current=[],v.next(["",null]),f([I.None,[]])),e.type===l.RemoveItems&&(j.current=j.current.filter((function(t){return e.payload.findIndex((function(e){return e.cellNumber===t.cellNumber}))<0})),f([I.ModifyCellsMode,Object(s.a)(j.current)]),t.next(e))}));return function(){e.unsubscribe(),n.unsubscribe()}}),[t,n,j,v]),Object(i.useEffect)((function(){var e=r.subscribe((function(e){console.log("remove >",e),c.next({type:l.RemoveItems,payload:[Object(d.a)({},e)],groupUrl:""})}));return function(){return e.unsubscribe()}}),[t,r]),console.log("state CartModal: ",a),Object(p.jsx)("div",{children:Object(p.jsx)(W,{title:"Crypto tiles",width:770,height:450,event$:c,open:a[0]!==I.None,children:Object(p.jsxs)("div",{className:"flex-cnt item wrap content-start overflow px-2",children:[a[0]===I.ModifyCellsMode&&Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-10 px-2 my-2",children:[Object(p.jsx)(m,{color:"secondary",noActive:!0,title:a[1].length>1?"group url":"url",small:!0}),Object(p.jsx)(U,{event$:v,value:h})]}),Object(p.jsxs)("div",{className:"flex-cnt item justify-start fb-10 wrap px-2 py-3",children:[a[0]===I.ModifyCellsMode&&a[1].length>1&&Object(p.jsx)("div",{className:"flex-cnt item fb-10 my-2",children:Object(p.jsx)(m,{color:"secondary",noActive:!0,title:"group tiles",small:!0})}),a[0]===I.ModifyCellsMode&&a[1].map((function(e){return Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-2 align-center shrink mx-1 px-3 py-1",style:{marginBottom:8,backgroundColor:"white"},children:[Object(p.jsx)("div",{className:"flex-cnt item fb-4 modal_cell-item",children:e.cellNumber+1}),Object(p.jsx)("div",{className:"flex-cnt item fb-3 justify-end",children:Object(p.jsx)(m,{action:e,light:!0,color:"error",title:"X",small:!0,event$:r})})]},e.cellNumber)})),a[0]===I.BuyCellsMode&&Object(p.jsx)("div",{className:"flex-cnt item wrap justify-start fb-10",children:a[1].map((function(e){return Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-10 align-center shrink mx-1 px-3 py-1",style:{marginBottom:8,backgroundColor:"white"},children:[Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"price (Eth)",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item justify-end fb-4",children:Object(p.jsx)(m,{color:"info",noActive:!0,title:"# "+e.cellNumber+1,small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(U,{noActive:!0,color:"header",value:e.token?""+e.token.price:""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"image url",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item fb-10 mt-1 mb-4",children:Object(p.jsx)(U,{event$:v,noActive:!!e.tile,value:e.tile&&e.tile.url||""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"title",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(U,{noActive:!0,color:"header",value:e.tile?""+e.tile.title:""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"bounded tiles",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 wrap",children:e.tile&&e.tile.boundedTiles.map((function(e){return Object(p.jsx)("div",{className:"flex-cnt item shrink my-1 mx-2",children:Object(p.jsx)(m,{color:"base",noActive:!0,title:e.toString(),small:!0})},e.toString())}))}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 mt-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"center",noActive:!0,title:"owner address",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(U,{noActive:!0,color:"header",value:e.tile?""+e.tile.owner:""})})]},e.cellNumber)}))})]})]})})})},V=n(7),H=n.n(V),P=n(13),z=n(0),G=n(2),F=n(40),X=n(14),Y={apiKey:"AIzaSyD8Ad1yitALcRL8lBafsDVB3cqWXl4r0hY",authDomain:"tiles-c734c.firebaseapp.com",projectId:"tiles-c734c",storageBucket:"tiles-c734c.appspot.com",messagingSenderId:"895094851367",appId:"1:895094851367:web:e231bfb9953e7edc350b02"},J="<no-account>",q=function(e,t){return{tile:e,token:t,cellNumber:e.id,point:N(e.id)}},K={_id:1,id:-1,owner:J,price:"",url:""},Q=function(e){var t=e._id?{_id:e._id}:{};return Object(d.a)(Object(d.a)({},t),{},{id:""+e.id,owner:e.owner,tokenId:""+e.tokenId,title:e.title,url:e.url,boundedTiles:e.boundedTiles?e.boundedTiles.map((function(e){return""+e})).join(","):""})},Z=function(e){return{_id:e._id,id:Number(e.id),owner:e.owner,tokenId:Number(e.tokenId),title:e.title,url:e.url,boundedTiles:e.boundedTiles?(""+e.boundedTiles).split(",").map((function(e){return Number(e)})):[]}},ee=function(e){return{_id:e._id,id:Number(e.id),owner:"",price:e.price,url:""}},te=function(e){var t=e._id?{_id:e._id}:{};return Object(d.a)(Object(d.a)({},t),{},{id:Number(e.id),owner:"",price:e.price,url:""})},ne=function(){function e(){Object(z.a)(this,e),this._account=null,this._state=new v.BehaviorSubject({lastUpdate:0,tileCells:[]}),this._firebaseApp=void 0,this._db=void 0,this._tilesCollection=void 0,this._tokensCollection=void 0,this._firebaseApp=Object(F.a)(Y),this._db=Object(X.f)(this._firebaseApp),this._tilesCollection=Object(X.b)(this._db,"tiles"),this._tokensCollection=Object(X.b)(this._db,"tokens")}return Object(G.a)(e,[{key:"getState",value:function(){return this._state}},{key:"connect",value:function(){return this._account="test-owner-2",new Promise((function(e){return setTimeout((function(){return e(!0)}),2e3)}))}},{key:"getAccount",value:function(){return this._account}},{key:"getTileInfo",value:function(){var e=Object(P.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(X.d)(Object(X.c)(this._db,"tiles",""+t));case 3:return n=e.sent,e.abrupt("return",Z(Object(d.a)(Object(d.a)({},n.data()),{},{_id:n.id})));case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTokenInfo",value:function(){var e=Object(P.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(X.d)(Object(X.c)(this._db,"tokens",""+t));case 3:return n=e.sent,e.abrupt("return",ee(Object(d.a)(Object(d.a)({},n.data()),{},{_id:n.id})));case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTokensByIds",value:function(){var e=Object(P.a)(H.a.mark((function e(t){var n=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return n.fetchTokenInfo(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(){var t,n,r,c,l,i;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([Object(X.e)(this._tilesCollection),Object(X.e)(this._tokensCollection)]);case 3:return t=e.sent,n=Object(b.a)(t,2),r=n[0],c=n[1],l=r.docs.map((function(e){return Object(d.a)(Object(d.a)({},e.data()),{},{_id:e.id})})).map(Z),i=c.docs.map((function(e){return Object(d.a)(Object(d.a)({},e.data()),{},{_id:e.id})})).map(ee),console.log("%c tiles, tokens: ","border: 1px solid blue",r.docs,c.docs.map((function(e){return e.data()}))),this._state.next({lastUpdate:(new Date).getTime(),tileCells:l.map((function(e){var t=i.find((function(t){return t.id===e.tokenId}));return q(e,t||K)}))}),e.abrupt("return",Object(s.a)(l));case 14:throw e.prev=14,e.t0=e.catch(0),console.log("error with loading docs from collections: ",e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"groupTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(t,n){var r,c=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sort((function(e,t){return e.cellNumber>t.cellNumber?1:-1})),console.log("%c group tiles ","background-color: orange; color: green",t,Object(s.a)(r)),t.length){e.next=4;break}return e.abrupt("return",[!1,"no tiles for grouping"]);case 4:return e.prev=4,e.next=7,Promise.all(r.map((function(e,t){return Object(X.g)(Object(X.c)(c._db,"tiles",e.tile._id),Q(Object(d.a)(Object(d.a)({},e.tile),{},{url:t?"":n,boundedTiles:t?[]:r.map((function(e){return e.tile.id}))})))})));case 7:return e.next=9,this.fetchTiles();case 9:return e.abrupt("return",[!0,""]);case 12:throw e.prev=12,e.t0=e.catch(4),e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"buyTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(t,n){var r,c=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("%c buy tiles ","background-color: orange; color: darkcyan",t),t.length){e.next=3;break}return e.abrupt("return",[!1,"no tiles for buying"]);case 3:if(r=this.getAccount()){e.next=6;break}return e.abrupt("return",[!1,"no current account"]);case 6:return e.prev=6,e.next=9,Promise.all(t.map((function(e,t){return Object(X.g)(Object(X.c)(c._db,"tiles",e.tile._id),Q(Object(d.a)(Object(d.a)({},e.tile),{},{url:n,owner:r})))})));case 9:return e.next=11,this.fetchTiles();case 11:return e.abrupt("return",[!0,""]);case 14:throw e.prev=14,e.t0=e.catch(6),e.t0;case 17:case"end":return e.stop()}}),e,this,[[6,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"mintTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(t,n){var r,c=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mintTiles",t),console.log("%c mint tiles ","background-color: orange; color: green",t),this.getAccount()){e.next=5;break}return e.abrupt("return",[!1,"no current account address"]);case 5:if(t.length){e.next=7;break}return e.abrupt("return",[!1,"no tiles for minting"]);case 7:return e.prev=7,e.next=10,Promise.all(t.map((function(e,t){return Object(X.a)(c._tokensCollection,te({id:e.cellNumber,_id:void 0,owner:c.getAccount()||J,price:"2.5"}))})));case 10:return r=e.sent,console.log("mint result",r),e.next=14,Promise.all(t.map((function(e,t){return Object(X.a)(c._tilesCollection,Q({id:e.cellNumber,_id:void 0,boundedTiles:[],owner:c.getAccount()||J,title:(new Date).toLocaleString(),url:n,tokenId:e.cellNumber}))})));case 14:return e.next=16,this.fetchTiles();case 16:return e.abrupt("return",[!0,""]);case 19:throw e.prev=19,e.t0=e.catch(7),e.t0;case 22:case"end":return e.stop()}}),e,this,[[7,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),re=function(){var e=[x.cellWidth,x.cellHeight];console.log("%c render global app! ","border: 2px solid red; color: silver; background-color: darkblue;");var t=Object(i.useMemo)((function(){return new ne}),[]),n=Object(i.useMemo)((function(){return new v.BehaviorSubject(J)}),[]),c=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),o=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),u=Object(i.useRef)([]),a=Object(i.useMemo)((function(){return new O.Subject}),[]),b=Object(i.useMemo)((function(){return new O.Subject}),[]),f=Object(i.useMemo)((function(){return new O.Subject}),[]);return Object(i.useEffect)((function(){t.connect().then((function(e){var r=t.getAccount();r&&n.next(r),t.fetchTiles().then((function(e){return console.log("%c items loaded! ","color: green",Object(s.a)(e))}))})).catch((function(e){}))}),[t,n]),Object(i.useEffect)((function(){var e=c.subscribe((function(e){var t=e.filter((function(e){return e.mouseType===r.Click})).map((function(e){return e.curr})),n=[],c=Object(s.a)(t);Object(s.a)(u.current).forEach((function(e){c.find((function(t){return t.cellNumber===e.cellNumber}))||n.push(e),c=c.filter((function(t){return t.cellNumber!==e.cellNumber}))})),(c.length||n.length)&&(u.current=Object(s.a)(t),o.next(Object(s.a)(t)))}));return function(){return e.unsubscribe()}}),[c,o,u]),Object(i.useEffect)((function(){var e=a.subscribe((function(e){console.log("%c cartEvent ","border: 1px solid green",e,t.getState());var n=t.getState().getValue();if(e.type===l.Modify&&b.next({type:l.Modify,payload:n.tileCells.filter((function(e){return c.getValue().find((function(t){return t.mouseType===r.Click&&e.cellNumber===t.curr.cellNumber}))})),groupUrl:""}),e.type===l.Open&&b.next({type:l.Open,payload:c.getValue().filter((function(e){return e.mouseType===r.Click})).map((function(e){var t=n.tileCells.find((function(t){return t.cellNumber===e.curr.cellNumber}));return{cellNumber:e.curr.cellNumber,point:e.curr.point,tile:t&&t.tile,token:t&&t.token}})),groupUrl:""}),e.type===l.ShowOther)return f.next([S.DisplayAll,[]]);if(e.type===l.ShowOwn){var i=t.getAccount();console.log("my account: ",i),f.next([S.DisplayOwnCells,t.getState().getValue().tileCells.filter((function(e){return e.tile.owner===i})).map((function(e){return{mouseType:r.None,curr:{cellNumber:e.cellNumber,point:e.point},lastCell:{cellNumber:-1,point:[0,0]}}}))])}}));return function(){return e.unsubscribe()}}),[t,a,b,c,f]),Object(i.useEffect)((function(){var e=b.subscribe((function(e){if(console.log("%c cartState ","border: 1px solid blue",e),e.type===l.SaveTiles){var n=e.payload.filter((function(e){return!!e.tile&&!!e.token}));n.length&&t.groupTiles(Object(s.a)(n),e.groupUrl)}if(e.type===l.Buy){var r=e.payload.filter((function(e){return!!e.tile&&!!e.token}));r.length?t.buyTiles(Object(s.a)(r),e.groupUrl):(f.next([S.DisplayAll,[]]),t.mintTiles(Object(s.a)(e.payload),e.groupUrl))}if(e.type===l.RemoveItems){var c=e.payload.filter((function(e){return!!e.tile&&!!e.token}));f.next([S.Remove,Object(s.a)(c)])}if(e.type===l.Save){var i=e.payload.filter((function(e){return!!e.tile&&!!e.token}));f.next([S.UserUpdateTileGroup,Object(s.a)(i)])}}));return function(){return e.unsubscribe()}}),[t,f,b,c]),Object(p.jsx)("div",{id:"app-container",children:Object(p.jsxs)(y.Provider,{value:t,children:[Object(p.jsx)(j,{event$:a,selectedCells$:o}),Object(p.jsx)(R,{cellSize:e,currentAcc$:n,cellsAmount:x.cellsAmount,cellBorderWidth:x.cellBorderWidth,maxCanvasWidth:x.maxCanvasWidth||0,event$:c,cellsUpdate$:f}),Object(p.jsx)(L,{event$:b})]})})};a.a.render(Object(p.jsx)(re,{}),document.getElementById("root"))}},[[62,1,2]]]);
//# sourceMappingURL=main.47c1e43c.chunk.js.map