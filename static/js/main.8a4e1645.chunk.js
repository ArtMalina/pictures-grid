(this["webpackJsonppictures-grid"]=this["webpackJsonppictures-grid"]||[]).push([[0],{32:function(e,t,n){},33:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var l,r,c,i=n(1),o=n.n(i),u=n(23),a=n.n(u),s=(n(32),n(3)),b=(n(33),n(4)),d=n(26),f=n(2);!function(e){e[e.None=-1]="None",e[e.Move=0]="Move",e[e.Click=1]="Click"}(l||(l={})),function(e){e.None="<none>",e.Buy="<buy-cell>",e.Edit="<edit-cell>"}(r||(r={})),function(e){e.None="None",e.Open="Open",e.Close="Close",e.Save="Save",e.RemoveItems="RemoveItems",e.Modify="Modify",e.ShowOwn="ShowOwn",e.ShowOther="ShowOther",e.SaveTiles="SaveTiles"}(c||(c={}));var p=n(0),m=function(e){var t=e.title,n=e.event$,l=e.toggle,r=e.noActive,o=e.light,u=e.small,a=e.color,b=e.action,d=e.group,m=e.noBraces,j=e.fullWidth,h=e.textAlign,v=Object(i.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),n&&n.next(b?Object(f.a)(Object(f.a)({},b),{},{group:d}):{type:c.Close,payload:[]})}),[n,b,d]),O=[j&&"full-width",h&&"align-".concat(h),r&&"no-action",o&&"light",u&&"small",a].filter(Boolean).map((function(e){return"btn--".concat(e)}));return 1===l&&O.push("btn--untoggled"),2===l&&O.push("btn--toggled"),d&&O.push("btn--grouped"),Object(p.jsxs)("div",{className:["btn"].concat(Object(s.a)(O)).join(" "),onClick:v,children:[!m&&Object(p.jsx)("div",{className:"btn_border btn_border--left"}),!!t&&Object(p.jsx)("div",{className:"btn-text",children:t||""}),e.children,!m&&Object(p.jsx)("div",{className:"btn_border btn_border--right"})]})},j=function(e){var t=e.event$,n=e.selectedCells$,l=Object(i.useMemo)((function(){return new d.a}),[]),r=Object(i.useState)([1,2]),o=Object(b.a)(r,2),u=o[0],a=o[1],f=Object(i.useRef)(u),j=Object(i.useState)([]),h=Object(b.a)(j,2),v=h[0],O=h[1];return Object(i.useEffect)((function(){var e=l.subscribe((function(e){if(console.log("%c filterBtn ev: ","background-color: brown; color: white;",e),console.log("downEv togglesStateRef.current",f.current),e.type===c.ShowOwn){if(e.group){var n=Object(b.a)(f.current,2),l=n[0],r=n[1];f.current=[1===l?2:1,1===r?2:1],a(f.current)}return t.next({type:1===f.current[0]?c.ShowOther:c.ShowOwn,payload:e.payload})}t.next(e)}));return function(){return e.unsubscribe()}}),[l,t,f]),Object(i.useEffect)((function(){var e=n.subscribe((function(e){console.log("%c filterBtn ev: ","background-color: brown; color: white;",e),O(Object(s.a)(e))}));return function(){return e.unsubscribe()}}),[n]),Object(p.jsx)("header",{children:Object(p.jsxs)("div",{className:"header_content",children:[Object(p.jsx)("div",{className:"flex-cnt align-center mx-4",children:Object(p.jsx)(m,{light:!0,color:"header",title:"Hello, crypto man"})}),Object(p.jsx)("div",{style:{backgroundColor:"white",padding:"0 10px"}}),Object(p.jsxs)("div",{className:"flex-cnt align-center",children:[Object(p.jsx)("div",{className:"flex-cnt item fb-3",children:Object(p.jsxs)(m,{light:!0,small:!0,color:"primary",title:"TILES",event$:l,action:{type:c.ShowOwn,payload:[]},group:1,children:[Object(p.jsx)(m,{event$:l,action:{type:c.ShowOwn,payload:[]},light:!0,small:!0,noBraces:!0,group:1,toggle:u[0],color:"primary",title:"MY"}),Object(p.jsx)(m,{event$:l,action:{type:c.ShowOwn,payload:[]},light:!0,small:!0,noBraces:!0,group:2,toggle:u[1],color:"primary",title:"FOR SALE"})]})}),Object(p.jsxs)("div",{className:"flex-cnt justify-end",style:{width:250},children:[Object(p.jsx)("div",{className:"flex-cnt item shrink mx-3",children:Object(p.jsx)(m,{event$:t,action:{type:1===u[0]?c.Open:c.Modify,payload:[]},light:!0,color:"info",title:1===u[0]?"Details":"Modify"})}),Object(p.jsx)("div",{className:"flex-cnt item shrink badge-cnt",children:!!v.length&&Object(p.jsx)("div",{className:"badge badge--primary",children:1===u[0]?"!":v.length})})]})]})]})})},h=n(13),v=n(8),O=n(7),y=o.a.createContext(null),g=function(e){var t=e.width,n=e.height,r=e.event$,c=e.canvas2dCtxInList$,o=Object(i.useCallback)((function(e){r.next([l.Click,e])}),[r]),u=Object(i.useCallback)((function(e){r.next([l.Move,e])}),[r]),a=Object(i.useCallback)((function(e){if(e&&!c.getValue().length){var t=e.getContext("2d");t&&c.next([t])}}),[c]);return Object(p.jsx)("div",{id:"canvas-container",style:{width:t,height:n},children:Object(p.jsx)("canvas",{id:"canvas",onClick:o,onMouseMove:u,onMouseLeave:u,width:t,height:n,ref:a})})},x={inRowCells:0,cellsAmount:500,cellWidth:50,cellHeight:50,cellBorderWidth:2,maxCanvasWidth:1350};function N(e){var t=Math.floor(e/x.inRowCells);return[e-x.inRowCells*t,t]}x.inRowCells=Math.floor((x.maxCanvasWidth-x.cellBorderWidth)/(x.cellWidth+x.cellBorderWidth));var C,w=function(e,t){return t.reduce((function(t,n){return!t[0]&&!t[1]||t[e]>n[e]?[n[0],n[1]]:t}),[0,0])},T=function(e,t){return t.reduce((function(t,n){return!t[0]&&!t[1]||t[e]<n[e]?[n[0],n[1]]:t}),[0,0])},k=["#212529","#23272c","#22262b","#23282e","#25292e"];!function(e){e.BASE="#000000",e.HOVERED="yellow",e.SELECTED="orange",e.HOVER_SELECTED="#69f0ae",e.SHOW_FILTERED_TILES="silver"}(C||(C={}));var E,S=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return function(i){return[i[0]*e+n,i[1]*t+l,i[2]*e-r,i[3]*t-c]}},M=function(e,t,n,l,r,c){var i=Object(b.a)(t,1)[0],o=.5*c,u=.5*c;Array.from(new Array(n)).forEach((function(t,n){var a=c;u+l>i&&(u=.5*c,o+=r+c),function(t,n,i){(function(e,t,n,l){var r=Object(b.a)(t,4),c=r[0],i=r[1],o=r[2],u=r[3];e.beginPath(),e.fillStyle=k[Math.floor(5*Math.random())],e.rect(c,i,o+n,u+n),e.fill(),e.lineWidth=n,e.strokeStyle=C.BASE,e.stroke(),e.font="italic 12pt Arial",e.fillStyle="#4fc3f7",e.fillText("".concat(l.cellNumber.toString()),Math.round(c+.1*o),Math.round(i+.5*u-5))})(e,[n,i,l,r],c,{cellNumber:t+1,point:[-1,-1]})}(n,u,o),u+=l+a}))},A=function(e,t,n,l,r,c){var i=Object(b.a)(t.point,2),o=i[0],u=i[1],a=Object(b.a)(l,2),s=a[0],d=a[1],f=.5*r+(s+r)*o,p=.5*r+(d+r)*u;e.beginPath(),e.rect(f,p,s+r,d+r),e.lineWidth=r,e.strokeStyle=c,e.stroke()},B=function(e,t,n,l,r){var c,i=Object(b.a)(l,2),o=i[0],u=i[1],a={left:w(0,c=n),top:w(1,c),right:T(0,c),bottom:T(1,c)},s=a.left,d=a.right,f=a.bottom,p=a.top;console.warn("corners: left",s),console.warn("corners: right",d),console.warn("corners: top",p),console.warn("corners: bottom",f);var m=d[0]-s[0]+1,j=f[1]-p[1]+1;console.log("dx dy in bounded ",m,j,r);var h=S(t.width/m,t.height/j,-s[0]*t.width/m,-p[1]*t.height/j,1/m,1/j),v=S(o,u,1,1,0,0);n.forEach((function(n){console.log("t",n);var l=h([n[0],n[1],1,1]),c=Object(b.a)(l,4),i=c[0],o=c[1],u=c[2],a=c[3],s=v([n[0],n[1],1,1]),d=Object(b.a)(s,4),f=d[0],p=d[1],m=d[2],j=d[3];console.log("%c crop x-y-w-h ","background-color: brown;color: white",i,o,u,a),console.log("%c real x-y-w-h ","background-color: brown;color: white",f,p,m,j);var O=.5*r+r*n[0],y=.5*r+r*n[1];e.drawImage(t,i,o,u,a,f+O,p+y,m,j)}))},I=function(e){var t=e.cellW,n=e.cellH,r=e.cellBorderWidth,c=e.amount,o=e.canvas2dCtxInList$,u=e.event$,a=e.canvasSize;return Object(i.useEffect)((function(){console.log("%c render cells Grid! ","border: 1px solid orange;",a);var e=o.subscribe((function(e){e.forEach((function(e){M(e,a,c,t,n,r)}))}));return function(){return e.unsubscribe()}}),[t,n,r,c,a,o]),Object(i.useEffect)((function(){var e=u.subscribe((function(e){var c=e.displayCells,i=e.clearCells,u=e.displayTiles,a=(e.clearTiles,e.highlightCells);o.getValue().forEach((function(e){var o={},s={},d=[];u.forEach((function(l){console.log("%c tileCell ","background-color: grey; color: blue;",l),function(e,t,n,l,r){var c=Object(b.a)(l,2),i=c[0],o=c[1],u=Object(b.a)(t.point,2),a=u[0],s=u[1],d=r+(i+r)*a,f=r+(o+r)*s;if(e.beginPath(),e.fillStyle="#37474f",e.rect(d,f,i,o),e.fill(),t.tile.url){var p=new Image;p.onload=function(){if(t.tile.boundedTiles.length&&t.tile.boundedTiles[0]===t.tile.id)return console.warn("draw image",p,t.tile),void B(e,p,t.tile.boundedTiles.map((function(e){return N(e)})),[i,o],r);console.log("draw tile cell",t),e.beginPath(),e.rect(d,f,i,o),e.fillStyle="#37474f",e.fill(),e.drawImage(p,d,f,i,o)},p.src=t.tile.url}}(e,l,0,[t,n],r)})),i.forEach((function(i){var u=i.cellNumber,a=i.point,s=c.filter((function(e){return e.mouseType===l.Click&&e.cellNumber===u}));o[u]=1,s.length||A(e,{cellNumber:u,point:a},0,[t,n],r,C.BASE)})),a.forEach((function(l){var c=l.cellNumber,i=l.point;A(e,{cellNumber:c,point:i},0,[t,n],r,C.SHOW_FILTERED_TILES)})),c.forEach((function(c){var i=c.cellNumber,o=c.mouseType,u=c.point,a=o===l.Click?C.SELECTED:C.HOVERED;s[i]?d.push(c):A(e,{cellNumber:i,point:u},0,[t,n],r,a),o===l.Click&&(s[i]=2),o===l.Move&&(s[i]=1)})),d.forEach((function(l){var c=l.cellNumber,i=l.point;A(e,{cellNumber:c,point:i},0,[t,n],r,C.HOVER_SELECTED)}))}))}));return function(){return e.unsubscribe()}}),[u,o,t,n,r,a]),null};!function(e){e[e.None=0]="None",e[e.Add=1]="Add",e[e.Remove=2]="Remove",e[e.UpdateByContract=3]="UpdateByContract",e[e.DisplayOwnCells=4]="DisplayOwnCells",e[e.DisplayOtherCells=5]="DisplayOtherCells",e[e.DisplayAll=6]="DisplayAll",e[e.UserUpdateTileGroup=7]="UserUpdateTileGroup"}(E||(E={}));var $,R=function(e,t,n){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:e.mouseType}},U=function(e){var t=Object(i.useRef)(r.Buy),n=Object(i.useMemo)((function(){return new v.BehaviorSubject("<test-account>")}),[]),c=e.cellSize,o=e.cellsAmount,u=e.cellBorderWidth,a=e.maxCanvasWidth,d=e.event$,m=e.cellsUpdate$,j=Object(i.useContext)(y),x=Object(b.a)(c,2),N=x[0],C=x[1],w=Object(i.useState)([0,0,!1]),T=Object(b.a)(w,2),k=T[0],S=T[1],M=Object(i.useRef)(null),A=Object(i.useRef)([0,0]),B=Object(i.useRef)([0,0]),$=Object(i.useRef)([]),U=Object(i.useRef)({}),D=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),W=Object(i.useMemo)((function(){return new O.Subject}),[]),_=Object(i.useMemo)((function(){return new v.BehaviorSubject({displayCells:[],clearCells:[],displayTiles:[],clearTiles:[],highlightCells:[],shadeCells:[]})}),[]),L=Object(i.useMemo)((function(){return new v.BehaviorSubject({})}),[]),V=Object(i.useState)([!1,null]),H=Object(b.a)(V,2),P=(H[0],H[1],Object(i.useCallback)((function(e){if(e){var t=N,n=a,l=Math.floor((n-u)/(t+u)),r=(l+1)*u+l*t,c=Math.ceil(o/l),i=c*C+c*u+u;M.current=e,B.current=[l,c],A.current=[r,i],S([r,i,!0])}}),[M,A,B,o,u,a,N,C]));return Object(i.useEffect)((function(){var e=j.getState().subscribe((function(e){console.log("new state",Object(f.a)({},e));var n=d.getValue(),c=U.current,i=n.reduce((function(e,t,n){return Object(f.a)(Object(f.a)({},e),{},Object(h.a)({},t.curr.cellNumber,n))}),{}),o={},u=!1;e.tileCells.forEach((function(t){console.log("tile",t,i),o[t.cellNumber]=[e.lastUpdate,Object(f.a)({},t)],(!c[t.cellNumber]||c[t.cellNumber]<e.lastUpdate)&&(c[t.cellNumber]=e.lastUpdate,i[t.cellNumber]>0&&(u=!0))})),u&&m.next([E.UpdateByContract,Object(s.a)(n)]),L.next(Object(f.a)({},o));var a=[];t.current===r.Edit&&(a=e.tileCells.filter((function(e){return e.tile&&e.tile.owner===j.getAccount()})).map((function(e){return{cellNumber:e.cellNumber,mouseType:l.None,point:e.point}})),$.current=Object(s.a)(a)),_.next({displayCells:[],clearCells:[],displayTiles:Object(s.a)(e.tileCells),clearTiles:[],highlightCells:Object(s.a)(a),shadeCells:[]})}));return function(){return e.unsubscribe()}}),[j,_,d,$,m,L,U,t]),Object(i.useEffect)((function(){var e=m.subscribe((function(e){var n=e[0],c=e[1];console.log("cellsUpdate$",n,c);var i=d.getValue();if(n===E.DisplayAll||n===E.DisplayOwnCells){var o=n===E.DisplayAll?Object(s.a)($.current):[];t.current=n===E.DisplayAll?r.Buy:r.Edit,$.current=e[1].map((function(e){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:l.None}}));var u=i.filter((function(e){return e.mouseType===l.Click&&o.findIndex((function(t){return t.cellNumber===e.curr.cellNumber}))<0})).map((function(e){return{cellNumber:e.curr.cellNumber,point:e.curr.point,mouseType:e.mouseType}}));return d.next(i.filter((function(e){return e.mouseType!==l.Click}))),_.next({displayCells:[],clearCells:[].concat(Object(s.a)(o),Object(s.a)(u)),displayTiles:[],clearTiles:[],highlightCells:Object(s.a)($.current),shadeCells:[]})}if(n!==E.UpdateByContract&&n===E.Remove){var a=i.filter((function(t){return t.mouseType!==l.Click||e[1].findIndex((function(e){return e.cellNumber===t.curr.cellNumber}))<0}));return d.next(Object(s.a)(a)),void _.next({displayCells:a.filter((function(e){return e.mouseType===l.Click})).map(R),clearCells:e[1].map((function(e){return{cellNumber:e.cellNumber,point:e.point,mouseType:l.Click}})),displayTiles:[],clearTiles:[],highlightCells:[],shadeCells:[]})}}));return function(){return e.unsubscribe()}}),[m,d,_,t,$]),Object(i.useEffect)((function(){var e=W.subscribe((function(e){var c=Object(b.a)(e,2),i=c[0],o=c[1],a=o.clientX,p=o.clientY,m=o.currentTarget,j=m.offsetLeft,h=m.offsetTop,v=M.current?[M.current.scrollLeft,M.current.scrollTop]:[0,0],O=Object(b.a)(v,2),y=O[0],g=O[1],x=d.getValue();if(a-j+y+u>=A.current[0]||a<=j||p<=h||p-h+g+u>=A.current[1]){var w=x.filter((function(e){return e.mouseType!==l.Move}));return _.next({displayCells:w.map(R),clearCells:x.filter((function(e){return e.mouseType===l.Move&&$.current.findIndex((function(t){return t.cellNumber===e.curr.cellNumber}))<0})).map(R),displayTiles:[],clearTiles:[],highlightCells:Object(s.a)($.current),shadeCells:[]}),void d.next(Object(s.a)(w))}var T=function(e,t,n){var l=n.inRowCount,r=n.cellW,c=n.cellH,i=Math.floor(e/r),o=Math.floor(t/c);return{cellNumber:o*l+i,x:i,y:o,w:r,h:c}}(a+y-j,p+g-h,{inRowCount:B.current[0],cellW:N+u,cellH:C+u}),k={cellNumber:T.cellNumber,point:[T.x,T.y]};if(i!==l.Move||!x.find((function(e){return e.mouseType===i&&e.curr.cellNumber===T.cellNumber}))){var E=t.current,S=n.getValue(),I=L.getValue(),U=i===l.Click,D=x.length&&i===l.Move,W=E===r.Edit&&U&&(!I[k.cellNumber]||I[k.cellNumber][1].tile.owner!==S);W&&(U=!1);var V={display:x.length||W?[]:[Object(f.a)(Object(f.a)({},k),{},{mouseType:i})],clear:[],finalCellEvents:x.length||W?[]:[{mouseType:i,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(f.a)({},k)}]};if(x.forEach((function(e){if(i===l.Click){if(E===r.Edit&&e.mouseType===l.Click&&(!I[e.curr.cellNumber]||I[e.curr.cellNumber][1].tile.owner!==S))return void(U=!1);if(E!==r.Edit||e.mouseType!==l.Click||W||e.curr.cellNumber!==k.cellNumber&&V.display.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:e.mouseType})),E===r.Buy&&e.mouseType===l.Click&&I[e.curr.cellNumber]&&I[e.curr.cellNumber][1].tile.owner===S)return;if(E===r.Buy&&e.curr.cellNumber!==k.cellNumber)return void V.clear.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:i}));if(e.curr.cellNumber===k.cellNumber&&e.mouseType===i)return U=!1,void V.clear.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:i}));e.curr.cellNumber===k.cellNumber&&e.mouseType!==i&&V.display.push(Object(f.a)(Object(f.a)({},k),{},{mouseType:l.Move})),V.finalCellEvents.push(Object(f.a)({},e))}if(i===l.Move){if(e.mouseType===i&&e.curr.cellNumber===k.cellNumber)return D=!1,void V.finalCellEvents.push(Object(f.a)({},e));if(e.curr.cellNumber===k.cellNumber&&e.mouseType===l.Click)return V.finalCellEvents.push(Object(f.a)({},e)),void V.display.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:e.mouseType}));if(e.mouseType===i&&e.curr.cellNumber!==k.cellNumber)return D=!1,V.clear.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:i})),V.finalCellEvents.push({mouseType:e.mouseType,lastCell:Object(f.a)({},e.curr),curr:Object(f.a)({},k)}),void V.display.push(Object(f.a)(Object(f.a)({},k),{},{mouseType:i}));V.finalCellEvents.push(Object(f.a)({},e)),V.display.push(Object(f.a)(Object(f.a)({},e.curr),{},{mouseType:e.mouseType}))}})),D&&(V.finalCellEvents.push({mouseType:i,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(f.a)({},k)}),V.display.push(Object(f.a)(Object(f.a)({},k),{},{mouseType:i}))),U){if(E===r.Buy&&I[k.cellNumber]&&I[k.cellNumber][1].tile.owner===S)return;V.finalCellEvents.push({mouseType:i,lastCell:{cellNumber:-1,point:[0,0]},curr:Object(f.a)({},k)}),V.display.push(Object(f.a)(Object(f.a)({},k),{},{mouseType:i}))}i===l.Click&&(W&&(V.finalCellEvents=V.finalCellEvents.filter((function(e){return e.mouseType!==l.Click}))),console.log("final res",U,Object(f.a)({},V))),(V.display.length||V.clear.length)&&_.next({displayCells:Object(s.a)(V.display),clearCells:V.clear.filter((function(e){return $.current.findIndex((function(t){return t.cellNumber===e.cellNumber}))<0})),displayTiles:[],clearTiles:[],highlightCells:$.current.filter((function(e){return V.display.findIndex((function(t){return t.cellNumber===e.cellNumber}))<0})),shadeCells:[]}),i===l.Click&&console.log("\nresult",Object(f.a)({},V)),d.next(Object(s.a)(V.finalCellEvents))}}));return function(){return e.unsubscribe()}}),[M,A,B,d,t,L,n,_,W,$,u,N,C]),Object(p.jsxs)("div",{id:"cells-body",className:"overflow",ref:P,children:[Object(p.jsx)(g,{width:k[0],height:k[1],canvas2dCtxInList$:D,event$:W}),k[0]&&k[1]&&Object(p.jsx)(I,{event$:_,canvas2dCtxInList$:D,amount:o,cellW:c[0],cellH:c[1],cellBorderWidth:u,canvasSize:[k[0],k[1]]})]})},D=n(47),W=function(e){var t=e.value,n=e.event$,l=e.noActive,r=e.light,c=e.small,o=e.color,u=e.action,a=Object(i.useState)(t||""),d=Object(b.a)(a,2),f=d[0],m=d[1],j=Object(i.useCallback)((function(e){m(e.currentTarget.value),n&&n.next([e.currentTarget.value,u])}),[n,u]),h=[l&&"no-action",r&&"light",c&&"small",o].filter(Boolean).map((function(e){return"text-input--".concat(e)}));return Object(p.jsx)("div",{className:["text-input"].concat(Object(s.a)(h)).join(" "),children:Object(p.jsx)("input",{type:"text",value:f,onChange:j,disabled:l})})},_=function(e){var t=e.title,n=e.width,l=e.height,r=e.event$,o=e.open,u=Object(i.useState)({type:c.Close,payload:[],groupUrl:""}),a=Object(b.a)(u,2),s=a[0],d=a[1];if(Object(i.useEffect)((function(){console.log("useEffect in modal....");var e=r.subscribe((function(e){console.log("ev in modal: ",e),[c.Modify,c.Open].includes(e.type)&&d(e)}));return function(){return e.unsubscribe()}}),[r]),console.log("Modal state",s),!o)return null;var f=!!s.payload.filter((function(e){return!e.token&&!e.tile})).length,j=s&&s.type===c.Modify?"Save":"Buy";return j=s&&s.type===c.Open?"Buy":j,j=f?"Mint":j,Object(p.jsx)("div",{id:"modal-overlay-cnt",children:Object(p.jsxs)("div",{id:"modal-cnt",style:{width:n,height:l,marginTop:-.8*l,marginLeft:-.5*n},children:[Object(p.jsxs)("div",{className:"header",children:[Object(p.jsx)(m,{light:!0,color:"header",noActive:!0,title:t}),Object(p.jsxs)("div",{className:"flex-cnt",children:[Object(p.jsx)(m,{event$:r,action:{type:c.Save,payload:[]},light:!0,color:"active",title:j}),Object(p.jsx)("div",{className:"flex-cnt item mx-1"}),Object(p.jsx)(m,{event$:r,action:{type:c.Close,payload:[]},light:!0,color:"close",title:"Close"})]})]}),Object(p.jsx)("div",{className:"content",children:e.children}),Object(p.jsx)("div",{className:"footer"})]})})};!function(e){e[e.None=0]="None",e[e.BuyCellsMode=1]="BuyCellsMode",e[e.ModifyCellsMode=2]="ModifyCellsMode"}($||($={}));var L=function(e){var t=e.event$,n=Object(i.useMemo)((function(){return new O.Subject}),[]),l=Object(i.useMemo)((function(){return new O.Subject}),[]),r=Object(i.useMemo)((function(){return new O.Subject}),[]),o=Object(i.useState)([$.None,[]]),u=Object(b.a)(o,2),a=u[0],d=u[1],j=Object(i.useRef)([]),h=a[1].reduce((function(e,t){return t.tile?e&&t.tile.url?"":t.tile.url||e:e}),""),v=Object(i.useMemo)((function(){return new D.a([h||"",null])}),[h]);return Object(i.useEffect)((function(){var e=t.subscribe((function(e){console.log("%c event$ in cart-modal: ","border: 1px solid green",e,v.getValue()),e.type!==c.Modify&&e.type!==c.Open||(v.next(["",null]),j.current=Object(s.a)(e.payload),d([e.type===c.Modify?$.ModifyCellsMode:$.BuyCellsMode,Object(s.a)(e.payload)]),r.next(e))})),n=r.subscribe((function(e){console.log("cart event",e,Object(s.a)(j.current)),e.type!==c.Close&&e.type!==c.Save||(e.type===c.Save&&(j.current.length?t.next({type:c.SaveTiles,payload:Object(s.a)(j.current),groupUrl:v.getValue()[0]}):t.next(e)),j.current=[],v.next(["",null]),d([$.None,[]])),e.type===c.RemoveItems&&(j.current=j.current.filter((function(t){return e.payload.findIndex((function(e){return e.cellNumber===t.cellNumber}))<0})),d([$.ModifyCellsMode,Object(s.a)(j.current)]),t.next(e))}));return function(){e.unsubscribe(),n.unsubscribe()}}),[t,n,j,v]),Object(i.useEffect)((function(){var e=l.subscribe((function(e){console.log("remove >",e),r.next({type:c.RemoveItems,payload:[Object(f.a)({},e)],groupUrl:""})}));return function(){return e.unsubscribe()}}),[t,l]),console.log("state CartModal: ",a),Object(p.jsx)("div",{children:Object(p.jsx)(_,{title:"Crypto tiles",width:770,height:450,event$:r,open:a[0]!==$.None,children:Object(p.jsxs)("div",{className:"flex-cnt item wrap content-start overflow px-2",children:[a[0]===$.ModifyCellsMode&&Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-10 px-2 my-2",children:[Object(p.jsx)(m,{color:"secondary",noActive:!0,title:a[1].length>1?"group url":"url",small:!0}),Object(p.jsx)(W,{event$:v,value:h})]}),Object(p.jsxs)("div",{className:"flex-cnt item justify-start fb-10 wrap px-2 py-3",children:[a[0]===$.ModifyCellsMode&&a[1].length>1&&Object(p.jsx)("div",{className:"flex-cnt item fb-10 my-2",children:Object(p.jsx)(m,{color:"secondary",noActive:!0,title:"group tiles",small:!0})}),a[0]===$.ModifyCellsMode&&a[1].map((function(e){return Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-2 align-center shrink mx-1 px-3 py-1",style:{marginBottom:8,backgroundColor:"white"},children:[Object(p.jsx)("div",{className:"flex-cnt item fb-4 modal_cell-item",children:e.cellNumber+1}),Object(p.jsx)("div",{className:"flex-cnt item fb-3 justify-end",children:Object(p.jsx)(m,{action:e,light:!0,color:"error",title:"X",small:!0,event$:l})})]},e.cellNumber)})),a[0]===$.BuyCellsMode&&Object(p.jsx)("div",{className:"flex-cnt item wrap justify-start fb-10",children:a[1].map((function(e){return Object(p.jsxs)("div",{className:"flex-cnt item wrap fb-10 align-center shrink mx-1 px-3 py-1",style:{marginBottom:8,backgroundColor:"white"},children:[Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"price (Eth)",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item justify-end fb-4",children:Object(p.jsx)(m,{color:"info",noActive:!0,title:"# "+e.cellNumber+1,small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(W,{noActive:!0,color:"header",value:e.token?""+e.token.price:""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"image url",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item fb-10 mt-1 mb-4",children:Object(p.jsx)(W,{event$:v,noActive:!!e.tile,value:e.tile&&e.tile.url||""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"title",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(W,{noActive:!0,color:"header",value:e.tile?""+e.tile.title:""})}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"left",noActive:!0,title:"bounded tiles",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 wrap",children:e.tile&&e.tile.boundedTiles.map((function(e){return Object(p.jsx)("div",{className:"flex-cnt item shrink my-1 mx-2",children:Object(p.jsx)(m,{color:"base",noActive:!0,title:e.toString(),small:!0})},e.toString())}))}),Object(p.jsx)("div",{className:"flex-cnt item fb-4 mt-4 shrink",children:Object(p.jsx)(m,{color:"close",textAlign:"center",noActive:!0,title:"owner address",small:!0})}),Object(p.jsx)("div",{className:"flex-cnt item shrink fb-10 mt-1 mb-4",children:Object(p.jsx)(W,{noActive:!0,color:"header",value:e.tile?""+e.tile.owner:""})})]},e.cellNumber)}))})]})]})})})},V=n(5),H=n.n(V),P=n(10),G=n(24),z=n(25),F=function(e,t){return{tile:e,token:t,cellNumber:e.id,point:N(e.id)}},J="<test-account>",X="<test2-account>",Y={1:"https://seeklogo.com/images/S/starcraft-2-logo-A2A8CE895F-seeklogo.com.png",2:"https://static10.tgstat.ru/channels/_0/8d/8d2631d77881c519b2d109c05eaa9d2b.jpg",5:"https://bnetcmsus-a.akamaihd.net/cms/blog_header/ci/CIGT53U8ZP6M1509744317189.jpg"},Z=[140,141,142,143,144,145,165,166,167,168,169,190,192,193,194,195],q=[{id:1,owner:J,tokenId:1,title:"test 1st tile",url:Y[1],boundedTiles:[]},{id:2,owner:J,tokenId:2,title:"test 1st tile",url:Y[2],boundedTiles:[]},{id:5,owner:X,tokenId:5,title:"test 2nd tile",url:Y[5],boundedTiles:[5,6]},{id:6,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:[5,6]},{id:321,owner:X,tokenId:321,title:"test 3d tile",url:Y[321],boundedTiles:[]},{id:140,owner:X,tokenId:5,title:"test 2nd tile",url:Y[5],boundedTiles:Z},{id:141,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:Z},{id:142,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:Z},{id:143,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:Z},{id:165,owner:X,tokenId:5,title:"test 2nd tile",url:"",boundedTiles:Z},{id:166,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:Z},{id:167,owner:X,tokenId:6,title:"test 3d tile",url:"",boundedTiles:Z}],K=[{id:1,owner:J,price:"1.2",url:""},{id:2,owner:J,price:"1.0",url:""},{id:5,owner:X,price:"2.0",url:""},{id:6,owner:X,price:"2.0",url:""},{id:321,owner:X,price:"1.0",url:""}],Q={id:-1,owner:"<no-account>",price:"",url:""},ee=function(){function e(){Object(G.a)(this,e),this._account=null,this._state=new v.BehaviorSubject({lastUpdate:0,tileCells:[]})}return Object(z.a)(e,[{key:"getState",value:function(){return this._state}},{key:"connect",value:function(){return this._account=J,new Promise((function(e){return setTimeout((function(){return e(!0)}),2e3)}))}},{key:"getAccount",value:function(){return this._account}},{key:"getTileInfo",value:function(){var e=Object(P.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",q.find((function(e){return e.id===t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTokenInfo",value:function(){var e=Object(P.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.find((function(e){return e.id===t}))||Q);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTokensByIds",value:function(){var e=Object(P.a)(H.a.mark((function e(t){var n=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return n.fetchTokenInfo(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(){var t,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=q.reduce((function(e,t){return e.includes(t.tokenId)?e:[].concat(Object(s.a)(e),[t.tokenId])}),[]),e.next=3,this.fetchTokensByIds(t);case 3:return n=e.sent,this._state.next({lastUpdate:(new Date).getTime(),tileCells:q.map((function(e){var t=n.find((function(t){return t.id===e.tokenId}));return F(e,t||Q)}))}),e.abrupt("return",Object(s.a)(q));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"groupTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(t,n){var l,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.sort((function(e,t){return e.cellNumber>t.cellNumber?1:-1})),r=l[0],console.log("%c group tiles ","background-color: orange; color: green",t),t.length){e.next=5;break}return e.abrupt("return",[!1,"no tiles for grouping"]);case 5:return q=q.reduce((function(e,t){var c=l.find((function(e){return e.tile.id===t.id}));return console.log("grouping....",t.id,c),[].concat(Object(s.a)(e),c?[Object(f.a)(Object(f.a)({},t),{},{url:r.tile.id===t.id?n:"",boundedTiles:l.map((function(e){return e.tile.id}))})]:[Object(f.a)({},t)])}),[]),e.next=8,this.fetchTiles();case 8:return e.abrupt("return",[!0,""]);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"mintTiles",value:function(){var e=Object(P.a)(H.a.mark((function e(t,n){var l;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mintTiles",t),console.log("%c mint tiles ","background-color: orange; color: green",t),l=this.getAccount()){e.next=5;break}return e.abrupt("return",[!1,"no current account address"]);case 5:if(t.length){e.next=7;break}return e.abrupt("return",[!1,"no tiles for minting"]);case 7:return t.forEach((function(e){q.push({id:e.cellNumber,owner:l,tokenId:e.cellNumber,title:(new Date).toLocaleString(),url:n,boundedTiles:[]}),K.push({id:e.cellNumber,owner:l,price:e.token?e.token.price:"2.5",url:n})})),e.next=10,this.fetchTiles();case 10:return e.abrupt("return",[!0,""]);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),te=function(){var e=[x.cellWidth,x.cellHeight];console.log("%c render global app! ","border: 2px solid red; color: silver; background-color: darkblue;");var t=Object(i.useMemo)((function(){return new ee}),[]),n=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),r=Object(i.useMemo)((function(){return new v.BehaviorSubject([])}),[]),o=Object(i.useRef)([]),u=Object(i.useMemo)((function(){return new O.Subject}),[]),a=Object(i.useMemo)((function(){return new O.Subject}),[]),b=Object(i.useMemo)((function(){return new O.Subject}),[]);return Object(i.useEffect)((function(){t.connect().then((function(e){t.fetchTiles().then((function(e){return console.log("%c items loaded! ","color: green",Object(s.a)(e))}))})).catch((function(e){}))}),[t]),Object(i.useEffect)((function(){var e=n.subscribe((function(e){var t=e.filter((function(e){return e.mouseType===l.Click})).map((function(e){return e.curr})),n=[],c=Object(s.a)(t);Object(s.a)(o.current).forEach((function(e){c.find((function(t){return t.cellNumber===e.cellNumber}))||n.push(e),c=c.filter((function(t){return t.cellNumber!==e.cellNumber}))})),(c.length||n.length)&&(o.current=Object(s.a)(t),r.next(Object(s.a)(t)))}));return function(){return e.unsubscribe()}}),[n,r,o]),Object(i.useEffect)((function(){var e=u.subscribe((function(e){console.log("%c cartEvent ","border: 1px solid green",e,t.getState());var r=t.getState().getValue();if(e.type===c.Modify&&a.next({type:c.Modify,payload:r.tileCells.filter((function(e){return n.getValue().find((function(t){return t.mouseType===l.Click&&e.cellNumber===t.curr.cellNumber}))})),groupUrl:""}),e.type===c.Open&&a.next({type:c.Open,payload:n.getValue().filter((function(e){return e.mouseType===l.Click})).map((function(e){var t=r.tileCells.find((function(t){return t.cellNumber===e.curr.cellNumber}));return{cellNumber:e.curr.cellNumber,point:e.curr.point,tile:t&&t.tile,token:t&&t.token}})),groupUrl:""}),e.type===c.ShowOther)return b.next([E.DisplayAll,[]]);if(e.type===c.ShowOwn){var i=t.getAccount();console.log("my account: ",i),b.next([E.DisplayOwnCells,t.getState().getValue().tileCells.filter((function(e){return e.token.owner===i})).map((function(e){return{mouseType:l.None,curr:{cellNumber:e.cellNumber,point:e.point},lastCell:{cellNumber:-1,point:[0,0]}}}))])}}));return function(){return e.unsubscribe()}}),[t,u,a,n,b]),Object(i.useEffect)((function(){var e=a.subscribe((function(e){if(console.log("%c cartState ","border: 1px solid blue",e),e.type===c.SaveTiles){var n=e.payload.filter((function(e){return!!e.tile&&!!e.token}));n.length?t.groupTiles(Object(s.a)(n),e.groupUrl):(b.next([E.DisplayAll,[]]),t.mintTiles(Object(s.a)(e.payload),e.groupUrl))}if(e.type===c.RemoveItems){var l=e.payload.filter((function(e){return!!e.tile&&!!e.token}));b.next([E.Remove,Object(s.a)(l)])}if(e.type===c.Save){var r=e.payload.filter((function(e){return!!e.tile&&!!e.token}));b.next([E.UserUpdateTileGroup,Object(s.a)(r)])}}));return function(){return e.unsubscribe()}}),[t,b,a,n]),Object(p.jsx)("div",{id:"app-container",children:Object(p.jsxs)(y.Provider,{value:t,children:[Object(p.jsx)(j,{event$:u,selectedCells$:r}),Object(p.jsx)(U,{cellSize:e,cellsAmount:x.cellsAmount,cellBorderWidth:x.cellBorderWidth,maxCanvasWidth:x.maxCanvasWidth||0,event$:n,cellsUpdate$:b}),Object(p.jsx)(L,{event$:a})]})})};a.a.render(Object(p.jsx)(te,{}),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.8a4e1645.chunk.js.map